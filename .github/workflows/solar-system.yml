name: Solar System Workflows


on:
 workflow_dispatch:
    inputs:
      job_to_run:
        description: 'Choose which job to run'
        required: true
        type: choice
        options:
          - unit-testing
          - code-coverage
          - docker

 push:
   branches:
     - main
     - 'feature/*'

env:
   MONGO_URI: 'mongodb+srv://supercluster.d83jj.mongodb.net/superData'
   MONGO_USERNAME: ${{ vars.MONGO_USERNAME }}
   MONGO_PASSWORD: ${{ secrets.MONGO_PASSWORD }}     

jobs:
 unit-testing:
   runs-on: ubuntu-latest
   if: ${{ github.event.inputs.job_to_run == 'unit-testing' || github.event_name == 'push' }}
   steps:
     - name: Checkout Code
       uses: actions/checkout@v2
    
     - name: Set up Node.js
       uses: actions/setup-node@v3
       with:
         node-version: 18
    
     - name: Install dependencies
       run: npm install
    
     - name: Run Unit Tests
       run: npm test
    
     - name: Archive Test Result
       uses: actions/upload-artifact@v3
       with:
         name: Mocha-Test-Result
         path: test-results.xml
 code-coverage:
   runs-on: ubuntu-latest
   if: ${{ github.event.inputs.job_to_run == 'code-coverage' || github.event_name == 'push' }}
   steps:
     - name: Checkout Code
       uses: actions/checkout@v2
    
     - name: Set up Node.js
       uses: actions/setup-node@v3
       with:
         node-version: 18
    
     - name: Install dependencies
       run: npm install
     
     - name: Check Coverage
       continue-on-error: true
       run: npm run coverage
       
    
     - name: Archive Test Results
       uses: actions/upload-artifact@v3
       with:
         name: Code-Coverage-Report
         path: coverage
         retention-days: 5
 docker:
   name: Containerization
   needs:
      - unit-testing
      - code-coverage
   runs-on: ubuntu-latest
   if: ${{ github.event.inputs.job_to_run == 'docker' || github.event_name == 'push' }}
   steps:
    - name: Checkout Repo
      uses: actions/checkout@v4

    - name: Login to Docker
      uses: docker/login-action@v3
      with:
          username: ${{ vars.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_PASSWORD }}             